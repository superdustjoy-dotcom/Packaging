<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åŒ…è£ç‰©æ–™å» å•†æ™ºæ…§ç³»çµ± - é’æ£ çµ‚æ¥µç‰ˆ</title>
    <style>
        :root { --primary: #34495e; --accent: #27ae60; --bg: #f0f2f5; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* é ‚éƒ¨å·¥å…·åˆ— */
        .top-tools { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .btn { padding: 8px 16px; border-radius: 6px; cursor: pointer; border: 1px solid #ddd; background: #fff; font-size: 13px; font-weight: bold; }
        .btn-export { background: #3498db; color: white; border: none; }
        .btn-reset { background: #e74c3c; color: white; border: none; }

        .search-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        .search-title { font-size: 24px; margin-bottom: 15px; color: var(--primary); }
        .search-bar { width: 85%; padding: 15px 25px; font-size: 18px; border: 2px solid #ddd; border-radius: 30px; outline: none; }
        .search-bar:focus { border-color: var(--accent); }

        .result-info { display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 20px; }
        .info-card { background: white; border-left: 8px solid var(--accent); padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card-header { font-size: 19px; font-weight: bold; color: #2c3e50; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        .info-grid { display: grid; grid-template-columns: 80px 1fr; gap: 8px; font-size: 14px; }
        .info-label { color: #7f8c8d; font-weight: bold; }
        .note-box { background: #fffdf0; border: 1px dashed #f1c40f; padding: 12px; margin-top: 10px; color: #d35400; white-space: pre-wrap; font-size: 13px; border-radius: 4px; line-height: 1.6; }

        .btn-group { margin-top: 15px; text-align: right; }
        .btn-edit { background: #f1c40f; color: white; border: none; }

        /* ç·¨è¼¯è¦–çª— */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; }
        .modal-content { background: white; width: 450px; margin: 50px auto; padding: 25px; border-radius: 10px; }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-tools">
        <button class="btn btn-reset" onclick="forceReset()">ğŸ”„ æ¸…é™¤è¨˜æ†¶</button>
        <button class="btn btn-export" onclick="exportUpdatedFile()">ğŸ’¾ åŒ¯å‡ºæœ€æ–°ç³»çµ±æª” (.html)</button>
    </div>

    <div class="search-section">
        <div class="search-title">ğŸ“¦ åŒ…è£ç‰©æ–™å» å•†æ™ºæ…§æŸ¥è©¢ç³»çµ±</div>
        <input type="text" id="mainSearch" class="search-bar" placeholder="æ‰“å…¥ã€ŒåŠ›ç¶­ã€æˆ–ã€Œåœ°çƒã€æˆ–æ–™ä»¶ç·¨è™Ÿ..." oninput="handleSearch()">
    </div>

    <div id="resultsArea" class="result-info"></div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>è³‡æ–™ç¶­è­·</h3>
        <input type="hidden" id="editIndex">
        <label>å» å•†åç¨±</label><input type="text" id="f_vendor">
        <label>é›»è©±</label><input type="text" id="f_phone">
        <label>ç‰©å“åç¨±</label><input type="text" id="f_item">
        <label>çµ±ç·¨</label><input type="text" id="f_taxid">
        <label>å‚™è¨»è©³æƒ… (æ–™ä»¶ç·¨è™Ÿ/ç´°ç¯€)</label><textarea id="f_note" rows="8"></textarea>
        <div style="text-align:right;">
            <button class="btn" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn btn-edit" onclick="saveData()">å„²å­˜æ›´æ”¹</button>
        </div>
    </div>
</div>

<script id="data-script">
    // ã€ä¸»è³‡æ–™å€ã€‘åŒ¯å‡ºæ™‚æœƒè‡ªå‹•æ›´æ–°é€™è£¡çš„å…§å®¹
    const initialData = [
        {
            vendor:"åŠ›ç¶­", phone:"04-22984101", taxid:"22478490", item:"(LINX5900)æ²¹å¢¨ã€æ·»åŠ åŠ‘", 
            note:"å¢¨æ°´1130 æ·»åŠ åŠ‘1575 1530(800) æ¸…(1300)\n\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A075-00\nå“åï¼šå™´å¢¨æ©Ÿ(5900)å¹´åº¦ä¿é¤Š\n\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A29E-00\nå“åï¼š5900å™´å¢¨æ©Ÿæ·»åŠ åŠ‘"
        },
        {
            vendor:"åœ°çƒç¶œåˆ", phone:"04-25667552", taxid:"07147916", item:"OPPé€æ˜è† å¸¶ã€æ°£æ³¡å¸ƒã€ç‰›çš®è²¼ç´™", 
            note:"æ–™ä»¶ç·¨è™Ÿï¼šMISC-A280-00\nå“åï¼šOPPæ©Ÿç”¨è† å¸¶(48*900M)\n\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A280-00\nå“åï¼šOPPè† å¸¶(48*90Y)"
        },
        {vendor:"æ°¸å˜‰ç››", phone:"23127982", item:"MISC-A280-00,MISC-A285-00(æ°£æ³¡å¸ƒ)", taxid:"16066029", note:""}
        // ... (å…¶ä»–è³‡æ–™)
    ];

    let db = JSON.parse(localStorage.getItem('smartPackageDB')) || initialData;

    function handleSearch() {
        const query = document.getElementById('mainSearch').value.toLowerCase();
        const resultsArea = document.getElementById('resultsArea');
        if (!query) { resultsArea.innerHTML = '<p style="text-align:center; color:#999; width:100%">è«‹è¼¸å…¥é—œéµå­—é–‹å§‹æŸ¥è©¢...</p>'; return; }

        const filtered = db.filter(d => 
            d.vendor.toLowerCase().includes(query) || d.item.toLowerCase().includes(query) || d.note.toLowerCase().includes(query)
        );

        resultsArea.innerHTML = filtered.map(d => `
            <div class="info-card">
                <div class="card-header">${highlight(d.vendor, query)}</div>
                <div class="info-grid">
                    <div class="info-label">é›»è©±ï¼š</div><div class="info-value">${d.phone || 'ç„¡'}</div>
                    <div class="info-label">çµ±ç·¨ï¼š</div><div class="info-value">${d.taxid || 'ç„¡'}</div>
                    <div class="info-label">ä¸»è¦ç‰©å“ï¼š</div><div class="info-value"><strong>${highlight(d.item, query)}</strong></div>
                </div>
                <div class="note-box">${highlight(d.note, query) || 'ç„¡è©³ç´°å‚™è¨»'}</div>
                <div class="btn-group"><button class="btn btn-edit" onclick="openEdit(${db.indexOf(d)})">ç·¨è¼¯</button></div>
            </div>
        `).join('');
    }

    function highlight(text, query) {
        if (!query || !text) return text;
        const re = new RegExp(`(${query})`, "gi");
        return text.replace(re, '<mark style="background:#ffeb3b; padding:0 2px">$1</mark>');
    }

    // --- å„²å­˜èˆ‡å½ˆçª—é‚è¼¯ ---
    function openEdit(index = null) {
        document.getElementById('editIndex').value = index;
        if (index !== null) {
            const d = db[index];
            document.getElementById('f_vendor').value = d.vendor;
            document.getElementById('f_phone').value = d.phone;
            document.getElementById('f_item').value = d.item;
            document.getElementById('f_taxid').value = d.taxid;
            document.getElementById('f_note').value = d.note;
        } else {
            document.querySelectorAll('#editModal input, textarea').forEach(i => i.value = '');
        }
        document.getElementById('editModal').style.display = 'block';
    }

    function saveData() {
        const index = document.getElementById('editIndex').value;
        const newData = {
            vendor: document.getElementById('f_vendor').value,
            phone: document.getElementById('f_phone').value,
            item: document.getElementById('f_item').value,
            taxid: document.getElementById('f_taxid').value,
            note: document.getElementById('f_note').value
        };
        if (index !== "") db[index] = newData;
        else db.push(newData);
        localStorage.setItem('smartPackageDB', JSON.stringify(db));
        closeModal();
        handleSearch();
    }

    function closeModal() { document.getElementById('editModal').style.display = 'none'; }

    function forceReset() {
        if(confirm("ç¢ºå®šè¦æ¸…é™¤ç¶²é è¨˜æ†¶ä¸¦è®€å–ä»£ç¢¼å…§çš„ initialData å—ï¼Ÿ")) {
            localStorage.removeItem('smartPackageDB');
            location.reload();
        }
    }

    // --- âœ¨ æ ¸å¿ƒåŠŸèƒ½ï¼šåŒ¯å‡ºåŒ…å«æœ€æ–°è³‡æ–™çš„ HTML æª”æ¡ˆ âœ¨ ---
    function exportUpdatedFile() {
        // å–å¾—ç›®å‰çš„ HTML å…¨æ–‡
        let htmlContent = document.documentElement.outerHTML;
        
        // å°‡æœ€æ–°çš„ db è½‰æ›ç‚º JSON å­—ä¸²
        const latestDataJson = JSON.stringify(db, null, 4);
        
        // ç”¨æ­£å‰‡è¡¨é”å¼å–ä»£æ‰åŸå§‹ç¢¼ä¸­çš„ initialData å…§å®¹
        const regex = /const initialData = \[\s*[\s\S]*? \];/;
        const replacement = `const initialData = ${latestDataJson};`;
        
        const newHtml = htmlContent.replace(regex, replacement);

        // å»ºç«‹ä¸‹è¼‰é€£çµ
        const blob = new Blob([newHtml], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'package_system_updated.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("åŒ¯å‡ºæˆåŠŸï¼è«‹ç”¨ä¸‹è¼‰çš„é€™å€‹æ–°æª”æ¡ˆå–ä»£æ‰ä½ åŸæœ¬çš„æœ¬åœ°æª”æ¡ˆï¼Œè³‡æ–™å°±æœƒæ°¸ä¹…åŒæ­¥ã€‚");
    }

    handleSearch();
</script>

</body>
</html>
