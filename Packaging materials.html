<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åŒ…è£ç‰©æ–™å» å•†æ™ºæ…§æŸ¥è©¢ç³»çµ± - é’æ£ </title>
    <style>
        :root { --primary: #34495e; --accent: #27ae60; --bg: #f0f2f5; --warn: #e67e22; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* æ™ºæ…§æœå°‹å€ */
        .search-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        .search-title { font-size: 24px; margin-bottom: 15px; color: var(--primary); font-weight: bold; }
        .search-bar { width: 80%; padding: 15px 25px; font-size: 18px; border: 2px solid #ddd; border-radius: 30px; outline: none; transition: 0.3s; }
        .search-bar:focus { border-color: var(--accent); box-shadow: 0 0 10px rgba(39, 174, 96, 0.2); }

        /* åŠŸèƒ½æŒ‰éˆ•å€ */
        .action-group { margin-top: 15px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .btn-main { padding: 10px 20px; border-radius: 25px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn-add { background: var(--primary); color: white; }
        .btn-sync { background: var(--accent); color: white; }
        .btn-import { background: #95a5a6; color: white; }

        /* çµæœè³‡è¨Šå¡ç‰‡ */
        .result-info { display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 20px; }
        .info-card { background: white; border-left: 8px solid var(--accent); padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-header { font-size: 18px; font-weight: bold; color: var(--primary); margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .info-grid { display: grid; grid-template-columns: 80px 1fr; gap: 8px; font-size: 14px; }
        .info-label { color: #7f8c8d; font-weight: bold; }
        .info-value { color: #2c3e50; word-break: break-all; }
        .info-tag { background: #e8f6f3; color: #27ae60; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-family: monospace; }

        .btn-group { margin-top: 15px; text-align: right; }
        .btn-sm { padding: 5px 12px; border-radius: 4px; cursor: pointer; border: 1px solid #ddd; background: #fff; font-size: 12px; }
        .btn-edit { background: #f1c40f; border: none; color: #fff; }

        /* å½ˆçª— */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; width: 450px; margin: 30px auto; padding: 25px; border-radius: 10px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 13px; }
        .form-group input, .form-group textarea { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="search-section">
        <div class="search-title">ğŸ“¦ åŒ…è£ç‰©æ–™è³‡è¨Šæ™ºæ…§ä»£å‡ºç³»çµ±</div>
        <input type="text" id="mainSearch" class="search-bar" placeholder="è¼¸å…¥é—œéµå­—ã€çµ±ç·¨æˆ–æ–™ä»¶ç·¨è™Ÿ..." oninput="handleSearch()">
        
        <div class="action-group">
            <button class="btn-main btn-add" onclick="openEdit()">+ æ–°å¢ç‰©æ–™</button>
            <button class="btn-main btn-sync" onclick="exportData()">ğŸ’¾ ä¸€éµæ‰“åŒ…(åŒ¯å‡ºå‚™ä»½)</button>
            <button class="btn-main btn-import" onclick="document.getElementById('importFile').click()">ğŸ“‚ åŒæ­¥é‚„åŸ(åŒ¯å…¥è³‡æ–™)</button>
            <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
        </div>
    </div>

    <div id="resultCount" style="margin-bottom: 10px; color: #666; font-size: 14px;"></div>
    <div id="resultsArea" class="result-info"></div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">è³‡æ–™ç¶­è­·</h3>
        <input type="hidden" id="editIndex">
        <div class="form-group"><label>å» å•†åç¨±</label><input type="text" id="f_vendor" list="vendorList"></div>
        <div class="form-group"><label>é›»è©±</label><input type="text" id="f_phone"></div>
        <div class="form-group"><label>ç‰©å“åç¨±/å“å</label><input type="text" id="f_item"></div>
        <div class="form-group"><label>çµ±ä¸€ç·¨è™Ÿ</label><input type="text" id="f_taxid"></div>
        <div class="form-group"><label>é¡åˆ¥/æ–™ä»¶ç·¨è™Ÿ</label><input type="text" id="f_cat"></div>
        <div class="form-group"><label>å‚™è¨»è³‡è¨Š</label><textarea id="f_note" rows="4"></textarea></div>
        <div style="text-align: right; margin-top: 20px;">
            <button class="btn-sm" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn-sm btn-edit" onclick="saveData()" style="padding: 8px 20px">ç¢ºèªå„²å­˜</button>
        </div>
    </div>
    <datalist id="vendorList"></datalist>
</div>

<script>
    // é è¼‰åŸå§‹è³‡æ–™ (åŒ…å«æ‚¨è¦æ±‚çš„ä¿®æ­£å…§å®¹)
    const initialData = [
        {vendor:"æ°¸å˜‰ç››", phone:"23127982", item:"MISC-A280-00,MISC-A285-00(æ°£æ³¡å¸ƒ)", taxid:"16066029", cat:"MISC-A285-00", note:""},
        {vendor:"æ°¸å˜‰ç››", phone:"23127982", item:"OPPé€æ˜è† å¸¶48mmã€æ°£æ³¡å¸ƒã€ç‰›çš®è²¼ç´™", taxid:"16066029", cat:"MISC-A280-00", note:""},
        {vendor:"é¦¬è‚¯ä¾ç‘ªå£«", phone:"", item:"(70)æ²¹å¢¨MB247-4;æ·»åŠ åŠ‘A188-4ã€æº¶åŠ‘5100-4", taxid:"89283852", cat:"", note:"A188-4 1340, 5100 420"},
        {vendor:"é¦¬è‚¯ä¾ç‘ªå£«", phone:"", item:"(90)æ²¹å¢¨MB-247-4;æ·»åŠ åŠ‘A188-4", taxid:"89283852", cat:"MISC-A075-00", note:"ä¿é¤Šåˆç´„"},
        {vendor:"é¦¬è‚¯ä¾ç‘ªå£«", phone:"", item:"X40ã€SD-5è‰²å¸¶3550", taxid:"89283852", cat:"MISC-A038-00", note:""},
        {vendor:"ä¿¡è¶ŠåŒ–å­¸å·¥æ¥­æ ªå¼æœƒç¤¾", phone:"", item:"åˆ‡åˆ€ç”¨çŸ½è† ", taxid:"", cat:"", note:""},
        {vendor:"ä¿¡è¶ŠåŒ–å­¸å·¥æ¥­æ ªå¼æœƒç¤¾", phone:"", item:"Shin-Etsu(KS-64 100g)", taxid:"", cat:"", note:""},
        {vendor:"å‡±å£«å£«", phone:"", item:"é–å¼ç´®å¸¶CV-200/Aæœ¬è‰²", taxid:"72108944", cat:"MISC-A284-00", note:""},
        {vendor:"å°ç£å¸Œæ‚…çˆ¾", phone:"03-3242988", item:"éµæ°Ÿé¾è† å¸¶(0.13mm*50mm*10m)", taxid:"23060459", cat:"MISC-A290-00", note:""},
        {vendor:"è—ç¿”", phone:"", item:"å¡‘è† è¢‹(0.07*550*830)", taxid:"16414738", cat:"MISC-A286-00", note:""},
        {vendor:"æ¡‚å’Œ", phone:"25331127-8", item:"ppç›’", taxid:"55988058", cat:"", note:""},
        {vendor:"å¾·æ˜±æˆ", phone:"02-22999176", item:"ç¢³å¸¶ã€å°å­—æ©Ÿ", taxid:"27637291", cat:"MISC-A280-00", note:""},
        {vendor:"æ¾å„ª", phone:"25273865", item:"æ©Ÿå™¨ç¶­ä¿®", taxid:"86220432", cat:"MISC-A030-00", note:""},
        {vendor:"æ±ä¿¡", phone:"", item:"ä¹¾ç‡¥åŠ‘", taxid:"56667701", cat:"", note:""},
        {vendor:"ç«‹æ·ç«‹", phone:"0933580178", item:"æ”¶ç¸®è†œ", taxid:"84419129", cat:"", note:""},
        {vendor:"æœ¬æºèˆˆ", phone:"0972293065", item:"æ”¶ç¸®è†œ", taxid:"", cat:"", note:""},
        {vendor:"çš‡å°‡", phone:"", item:"è²¼æ¨™æ©Ÿ", taxid:"80234971", cat:"", note:""},
        {vendor:"ä½‘æ·", phone:"", item:"æ“¦æ‹­ç´™", taxid:"97878835", cat:"MISC-A290-00", note:""},
        {vendor:"åŠ›ç¶­", phone:"04-22984101", item:"(LINX5900)æ²¹å¢¨ã€æ·»åŠ åŠ‘", taxid:"22478490", cat:"", note:"ã€æ–°å¢è³‡è¨Šã€‘\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A075-00 / å“åï¼šå™´å¢¨æ©Ÿ(5900)å¹´åº¦ä¿é¤Š\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A29E-00 / å“åï¼š5900å™´å¢¨æ©Ÿæ·»åŠ åŠ‘\n---\nå¢¨æ°´1130ã€æ·»åŠ åŠ‘1575ã€1530(800)ã€æ¸…(1300)"},
        {vendor:"æ™é´»", phone:"04-8392488", item:"è€—æç›¸é—œ", taxid:"53820647", cat:"MISC-A29E-00", note:""},
        {vendor:"å¤§å ¡", phone:"", item:"ä¸‰è¯å–®", taxid:"14053225", cat:"MISC-A038-01", note:""},
        {vendor:"æ–°å°", phone:"", item:"PEæ¡¶", taxid:"04348947", cat:"", note:""},
        {vendor:"åœ°çƒç¶œåˆ", phone:"04-25667552", item:"OPPæ©Ÿç”¨è† å¸¶ã€é€æ˜è† å¸¶ã€æ°£æ³¡å¸ƒ", taxid:"07147916", cat:"", note:"ã€æ–°å¢è³‡è¨Šã€‘\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A280-00 / å“åï¼šOPPæ©Ÿç”¨è† å¸¶(48*900M)\næ–™ä»¶ç·¨è™Ÿï¼šMISC-A280-00 / å“åï¼šOPPè† å¸¶(48*90Y)"},
        {vendor:"é£›æ—¦oräº¬æ—»", phone:"", item:"å°è¡¨æ©Ÿç¢³ç²‰åŒ£", taxid:"86243408", cat:"MISC-A034-00", note:""},
        {vendor:"æ™¶åœ“", phone:"", item:"é£Ÿå“ç´šä¹¾ç‡¥åŠ‘", taxid:"86336378", cat:"MISC-A280-00", note:""},
        {vendor:"ä½‘æ¬£é‡‘å±¬", phone:"04-25255897", item:"OPPè† å¸¶", taxid:"24375689", cat:"", note:""},
        {vendor:"ä¸–æºç§‘æŠ€", phone:"06-2425580", item:"é–‹ç›’æ©Ÿå¸ç›¤XP-F40N", taxid:"86575095", cat:"MISC-A070-00", note:""},
        {vendor:"éœ‡å¤§å°åˆ·", phone:"", item:"å°åˆ·å“", taxid:"5637944", cat:"", note:""}
    ];

    let db = JSON.parse(localStorage.getItem('smartPackageDB')) || initialData;

    function escapeRegExp(string) { return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

    function handleSearch() {
        const query = document.getElementById('mainSearch').value.trim().toLowerCase();
        const resultsArea = document.getElementById('resultsArea');
        const countArea = document.getElementById('resultCount');
        
        if (!query) {
            resultsArea.innerHTML = '<p style="text-align:center; color:#999; width:100%">è«‹è¼¸å…¥é—œéµå­—é–‹å§‹æŸ¥è©¢...</p>';
            countArea.innerText = "";
            return;
        }

        const filtered = db.map((item, index) => ({...item, originalIndex: index}))
                          .filter(d => 
                                d.item.toLowerCase().includes(query) || 
                                d.vendor.toLowerCase().includes(query) || 
                                d.taxid.includes(query) ||
                                d.cat.toLowerCase().includes(query) ||
                                (d.note && d.note.toLowerCase().includes(query))
                          );

        countArea.innerText = `æ‰¾åˆ° ${filtered.length} ç­†ç›¸é—œè³‡æ–™ï¼š`;
        resultsArea.innerHTML = filtered.map(d => `
            <div class="info-card">
                <div class="card-header">${highlight(d.item, query)}</div>
                <div class="info-grid">
                    <div class="info-label">å» å•†åç¨±:</div><div class="info-value"><strong>${highlight(d.vendor, query)}</strong></div>
                    <div class="info-label">é›»è©±:</div><div class="info-value">${d.phone || 'ç„¡'}</div>
                    <div class="info-label">çµ±ä¸€ç·¨è™Ÿ:</div><div class="info-value">${highlight(d.taxid, query)}</div>
                    <div class="info-label">æ–™ä»¶/é¡åˆ¥:</div><div class="info-value"><span class="info-tag">${highlight(d.cat, query) || 'æœªåˆ†é¡'}</span></div>
                    <div class="info-label">å‚™è¨»:</div><div class="info-value" style="color:#e67e22; white-space: pre-line; font-size:13px;">${highlight(d.note || '-', query)}</div>
                </div>
                <div class="btn-group">
                    <button class="btn-sm btn-edit" onclick="openEdit(${d.originalIndex})">ç·¨è¼¯è³‡è¨Š</button>
                </div>
            </div>
        `).join('');
    }

    function highlight(text, query) {
        if (!query || !text) return text;
        const escapedQuery = escapeRegExp(query);
        const re = new RegExp(`(${escapedQuery})`, "gi");
        return text.replace(re, '<mark style="background:#ffeb3b; padding:0 2px">$1</mark>');
    }

    // --- åŒæ­¥åŠŸèƒ½ï¼šä¸€éµæ‰“åŒ…åŒ¯å‡º ---
    function exportData() {
        const dataStr = JSON.stringify(db, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `åŒ…è£ç‰©æ–™å‚™ä»½_${new Date().toISOString().slice(0,10)}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    // --- åŒæ­¥åŠŸèƒ½ï¼šé‚„åŸåŒ¯å…¥ ---
    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (Array.isArray(importedData)) {
                    if(confirm(`ç¢ºå®šè¦åŒ¯å…¥è³‡æ–™å—ï¼Ÿé€™å°‡æœƒè¦†è“‹ç›®å‰çš„ ${db.length} ç­†è³‡æ–™ã€‚`)) {
                        db = importedData;
                        localStorage.setItem('smartPackageDB', JSON.stringify(db));
                        handleSearch();
                        alert("åŒ¯å…¥æˆåŠŸï¼è³‡æ–™å·²åŒæ­¥ã€‚");
                    }
                } else {
                    alert("æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ç¢ºä¿æ˜¯æœ‰æ•ˆçš„ JSON å‚™ä»½æª”ã€‚");
                }
            } catch (err) {
                alert("è®€å–æª”æ¡ˆå¤±æ•—ï¼š" + err);
            }
        };
        reader.readAsText(file);
    }

    function openEdit(index = null) {
        const modal = document.getElementById('editModal');
        document.getElementById('editIndex').value = (index !== null) ? index : "";
        document.getElementById('modalTitle').innerText = (index !== null) ? 'ç·¨è¼¯è³‡è¨Š' : 'æ–°å¢å…¨æ–°ç‰©æ–™è³‡æ–™';
        
        const vendorList = document.getElementById('vendorList');
        const uniqueVendors = [...new Set(db.map(d => d.vendor))];
        vendorList.innerHTML = uniqueVendors.map(v => `<option value="${v}">`).join('');

        if (index !== null) {
            const d = db[index];
            document.getElementById('f_vendor').value = d.vendor;
            document.getElementById('f_phone').value = d.phone;
            document.getElementById('f_item').value = d.item;
            document.getElementById('f_taxid').value = d.taxid;
            document.getElementById('f_cat').value = d.cat;
            document.getElementById('f_note').value = d.note;
        } else {
            ['f_vendor','f_phone','f_item','f_taxid','f_cat','f_note'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }
        modal.style.display = 'block';
    }

    function saveData() {
        const indexVal = document.getElementById('editIndex').value;
        const newData = {
            vendor: document.getElementById('f_vendor').value.trim(),
            phone: document.getElementById('f_phone').value.trim(),
            item: document.getElementById('f_item').value.trim(),
            taxid: document.getElementById('f_taxid').value.trim(),
            cat: document.getElementById('f_cat').value.trim(),
            note: document.getElementById('f_note').value.trim()
        };

        if (!newData.vendor || !newData.item) { alert("å» å•†èˆ‡å“åç‚ºå¿…å¡«ï¼"); return; }

        if (indexVal !== "") db[parseInt(indexVal)] = newData;
        else db.push(newData);

        localStorage.setItem('smartPackageDB', JSON.stringify(db));
        closeModal();
        handleSearch();
    }

    function closeModal() { document.getElementById('editModal').style.display = 'none'; }

    handleSearch();
</script>

</body>
</html>
